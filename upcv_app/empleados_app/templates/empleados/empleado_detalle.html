{% extends 'empleados/base.html' %}

{% load static %}

{% block content %}
<!-- Page Sidebar Ends-->
<script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/fontfaceobserver/2.1.0/fontfaceobserver.standalone.min.js"></script>
<link href="https://fonts.googleapis.com/css2?family=Mordato:wght@400;700&display=swap" rel="stylesheet">
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap" rel="stylesheet">

<style>
  /* Usar fuentes comunes para mayor compatibilidad */
  body {
    font-family: 'Arial', 'Helvetica', 'Verdana', sans-serif;
  }

  .t {
    font-family: 'Arial', 'Helvetica', 'Verdana', sans-serif;
    font-weight: bold;
  }

  .t2 {
    font-family: 'Arial', 'Helvetica', 'Verdana', sans-serif;
  }

  .t3 {
    font-family: 'Poppins', sans-serif;
    color: #275393;
    font-size: 53px;
    font-weight: bold;
    padding-left: 3.3em;
    position: relative;
    top: 15px; /* Ajusta el valor según sea necesario */
  }

  .t4 {
    font-family: 'Poppins', sans-serif;
    color: #275393;
    font-size: 53px;
    font-weight: bold;
    padding-left: 5.3em;
    position: relative;
    top: -5px; /* Ajusta el valor según sea necesario */
}


.t5 {
    font-family: 'Poppins', sans-serif;
    color: #090909;
    font-size: 45px;
    font-weight: bold;
    padding-left: 6.5em;
    position: relative;
    top: 115px; /* Ajusta el valor según sea necesario */
}

.t6 {
    font-family: 'Poppins', sans-serif;
    color: #111111;
    font-size: 50px;
    padding-left: 5.8em;
    position: relative;
    top: 118px; /* Ajusta el valor según sea necesario */
}

.t7 {
  font-family: 'Poppins', sans-serif;
    color: #090909;
    font-size: 25px;

    padding-left: 14em;
    position: relative;
    top: 140px; /* Ajusta el valor según sea necesario */
}

.t8 {
  font-family: 'Poppins', sans-serif;
    color: #0f0f0f;
    font-size: 25px;
  
    padding-left: 14em;
    position: relative;
    top: 143px; /* Ajusta el valor según sea necesario */
}

.t9 {
    font-family: 'Mordato', sans-serif;
    color: #275393;
    font-size: 25px;
    font-weight: bold;
    padding-left: 7.8em;
    position: relative;
    top: 60px; /* Ajusta el valor según sea necesario */
}

.t10 {
  font-family: 'Poppins', sans-serif;
    color: #275393;
    font-size: 28px;
   
    padding-left: 1em;
    position: relative;
    top: 50px; /* Ajusta el valor según sea necesario */
}

.t11 {
    font-family: 'Poppins', sans-serif;
    color: #030303;
    font-size: 35px;
    font-weight: bold;
    padding-left: 18.5em;
    position: relative;
    top:150px; /* Ajusta el valor según sea necesario */
}


  svg text {
    position: absolute;
  }

  /* Estilos específicos para impresión */
  @media print {
    body {
      font-family: 'Arial', 'Helvetica', sans-serif;
      margin: 0;
      padding: 0;
      background-color: white;
    }

    .page-body {
      display: block;
      background-color: white;
    }

    .container-fluid, .edit-profile, .card {
      width: 100%;
      height: auto;
      background-color: white;
    }

    .logotipos {
      display: none;
    }

    button {
      display: none;
    }

    .gafetes-container {
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
      page-break-inside: avoid;
    }

    .gafete {
      width: 880px;
      height: 565px;
      page-break-after: always;
    }
  }

  /* Estilos del botón "Imprimir Gafete" */
  #print-button {
    display: block;
    margin: 5px auto;
    padding: 12px 25px;
    background-color: #20056d;
    color: white;
    border: none;
    border-radius: 5px;
    font-size: 18px;
    cursor: pointer;
    transition: background-color 0.3s;
  }

  #print-button:hover {
    background-color: #7445a0;
  }

  /* Centrar el botón debajo del gafete */
  .gafete {
    margin-bottom: 20px;
  }
</style>

<div class="page-body">
  <div class="container-fluid">
    <div class="edit-profile">
      <div class="row">
        <div class="gafetes-container">
          <div class="col-xl-12 gafete">
            <div class="card" style="width: 880px; height: 565px;">
              <div class="card-body gafete-card" id="gafete" style="width: 880px; height: 565px;">
                <div class="gafete-header">
                  <text x="150%" y="55" class="t3" font-size="29" font-weight="bold" fill="#182b55">
                    {{ configuracion.nombre_institucion }}
                  </text>
                  <text x="70%" y="50" class="t4" font-size="29" font-weight="bold" fill="#182b55">
                    {{ configuracion.nombre_institucion2 }}
                  </text>
                </div>
                <div>
                  <text x="70" y="20" class="t5" font-size="30" fill="#182b55">{{ empleado.nombres|default:"Nombre no disponible" }}</text>
                </div>
                <div>
                  <text x="70" y="20" class="t6" font-size="39" font-weight="bold" fill="#182b55">{{ empleado.apellidos|default:"Apellidos no disponibles" }}</text>
                </div>
                <div>
                  <text x="70" y="20" class="t7" font-size="39" font-weight="bold" fill="#182b55">{{ empleado.grado|default:" no ingresado" }}</text>
                </div>
                <div>
                  <text x="70" y="20" class="t8" font-size="39" font-weight="bold" fill="#182b55">{{ empleado.grado.descripcion|default:"" }}</text>
                </div>
                <div>
                  <text x="570" y="20" class="t10" font-size="39" font-weight="bold" fill="#182b55">                    {{ configuracion.sitio_web|slice:"8:" }}                  </text>
                </div>
            
                <div>
                  <text x="570" y="20" class="t11" font-size="39" font-weight="bold" fill="#182b55">{{ empleado.tel }}</text>
                </div>
               
                {% if empleado.imagen %}
                <img src="{{ empleado.imagen.url }}" alt="Imagen del empleado" width="150" height="auto" class="gafete-img">
              {% else %}
                <p>No hay imagen cargada</p>
              {% endif %}
                
                <div style="display: flex; justify-content: space-between; padding: 50px; flex-wrap: wrap;">
                  <!-- Información del empleado en contenedor SVG para manipulación de texto -->
                  <svg width="880" height="565">
                    <!-- Aquí se pueden modificar fácilmente las coordenadas 'x' y 'y' -->
                  </svg>

                  <!-- Incluir logotipos directamente en el canvas -->
                  <div class="logotipos">
                    {% if configuracion.logotipo %}
                      <div class="logotipo">
                        <img src="{{ configuracion.logotipo.url }}" alt="Logotipo 1" width="170" height="auto">
                      </div>
                    {% endif %}
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

{% if user.is_authenticated %}
  <div style="display: flex; gap: 10px; justify-content: center; margin-top: 20px;">
    <button id="download-gafete-button" onclick="downloadGafete()" style="padding: 12px 25px; background-color: #180269; color: white; border: none; border-radius: 5px; font-size: 18px; cursor: pointer;">Descargar Gafete</button>
  </div>
{% endif %}

<script>
  function downloadGafete() {
    var element = document.getElementById('gafete');
    html2canvas(element, {
        useCORS: true,
        backgroundColor: null,
        scale: 3,
        width: 880,
        height: 565,
        allowTaint: true,
        logging: true,
    }).then(function(canvas) {
        var link = document.createElement('a');
        
        // Obtener el nombre del empleado desde el objeto 'empleado' en Django
        var nombreEmpleado = '{{ empleado.nombres }}';  // Nombre del empleado
        var apellidosEmpleado = '{{ empleado.apellidos }}';  // Apellidos del empleado
        
        // Si los valores están vacíos, asignar un nombre por defecto
        if (!nombreEmpleado) nombreEmpleado = "empleado";
        if (!apellidosEmpleado) apellidosEmpleado = "desconocido";
        
        // Usar el nombre del empleado para el nombre del archivo
        var nombreArchivo = nombreEmpleado + '_' + apellidosEmpleado + '_gafete.jpg';

        link.href = canvas.toDataURL('image/jpeg', 1.0); // Usa calidad máxima de la imagen
        link.download = nombreArchivo;  // Nombre del archivo descargado
        link.click();
    }).catch(function(error) {
        console.error("Error al generar la imagen:", error);
    });
  }
</script>

<style>
  .card-body {
    position: relative;
    background: url('{% static 'assets/svg/empleado.svg' %}') no-repeat center center;
    background-size: cover;
  }

  .qr-code {
    position: absolute;
    top: 100px;
    left: 650px;
    z-index: 10;
  }

  .gafete-img {
    position: relative;
    top: -250px;
    left: 10px;
    border-radius: 10%;
    width: 250px;
    height: 350px;
    object-fit: cover;
    object-position: center;
}

  .logotipos {
    display: flex;
    justify-content: space-between;
    gap: 5px;
    position: absolute;
    top: 40px;
    left: 12px;
  }

  .logotipo {
    text-align: center;
    position: relative;
    top: 5;
    left: 0;
  }

  .logotipo img {
    max-width: 200px;
    height: auto;
  }
</style>

{% endblock %}
