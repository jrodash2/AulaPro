{% extends 'empleados/base.html' %}
{% load static %}
{% block content %}
{% include 'empleados/partials_gafete_estilos.html' %}
<div class="page-body">
  <div class="container-fluid">
    <div class="page-title"><div class="row"><div class="col-6"><h4>Editor de Gafete</h4></div><div class="col-6"><ol class="breadcrumb"><li class="breadcrumb-item">Académico</li><li class="breadcrumb-item">Establecimientos</li><li class="breadcrumb-item active">Editor</li></ol></div></div></div>
  </div>
  <div class="container-fluid">
    <div class="row">
      <div class="col-xxl-9">
        <div class="card">
          <div class="card-header card-no-border pb-0"><h5>Vista previa</h5></div>
          <div class="card-body">
            <div class="gafete" style="margin:0 auto; width:880px; max-width:100%;">
              {% include 'aulapro/partials/_gafete_render.html' with alumno=alumno grado=alumno.grado establecimiento=establecimiento layout_json=layout_preview preview_id='editor-canvas' %}
            </div>
            <small class="text-muted">Arrastra los textos para actualizar coordenadas (x,y).</small>
          </div>
        </div>
      </div>
      <div class="col-xxl-3">
        <div class="card">
          <div class="card-header card-no-border pb-0"><h5>Herramientas</h5></div>
          <div class="card-body">
            <div class="mb-3"><label class="form-label">Campo</label><select id="field-select" class="form-control"></select></div>
            <div class="mb-3"><label class="form-label">Etiqueta</label><input id="field-label" class="form-control" readonly></div>
            <div class="mb-3"><label class="form-label">Clase CSS (Riho)</label><input id="field-class" class="form-control" placeholder="Ej: t5"></div>
            <div class="row g-2">
              <div class="col-6"><label class="form-label">Tamaño</label><input id="field-size" type="number" min="10" max="120" class="form-control"></div>
              <div class="col-6"><label class="form-label">Peso</label><select id="field-weight" class="form-control"><option>300</option><option>400</option><option>600</option><option>700</option><option>800</option></select></div>
              <div class="col-6"><label class="form-label">Alineación</label><select id="field-align" class="form-control"><option value="left">Izquierda</option><option value="center">Centro</option><option value="right">Derecha</option></select></div>
              <div class="col-6"><label class="form-label">Visible</label><select id="field-visible" class="form-control"><option value="true">Sí</option><option value="false">No</option></select></div>
            </div>
            <div class="row g-2 mt-1">
              <div class="col-5"><label class="form-label">Color</label><input id="field-color-picker" type="color" class="form-control form-control-color w-100"></div>
              <div class="col-7"><label class="form-label">Hex</label><input id="field-color-text" class="form-control" placeholder="#111111"></div>
            </div>
            <div class="mt-2"><small id="field-coords" class="text-muted">x:0 y:0</small></div>
            <button id="save-layout" class="btn btn-primary w-100 mt-3">Guardar diseño</button>
            <button id="reset-layout" type="button" class="btn btn-outline-secondary w-100 mt-2">Restablecer</button>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
<style>.gafete-field{position:absolute;cursor:move;z-index:5;user-select:none;pointer-events:auto;white-space:nowrap}</style>
<script>
window.gafeteEditorData = {
  layout: {{ layout|safe }},
  defaultLayout: {{ default_layout|safe }},
  saveUrl: "{% url 'empleados:guardar_diseno_gafete' establecimiento.id %}",
  csrf: "{{ csrf_token }}"
};
</script>
<script src="{% static 'js/editor_gafete.js' %}"></script>
{% endblock %}
